(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d601df9c"],{"37b2":function(e,t,a){},b721:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",[a("div",{staticClass:"jumbotron"},[a("h1",{attrs:{align:"center"}},[e._v("Chat with "+e._s(e.chatWith))]),a("div",{directives:[{name:"chat-scroll",rawName:"v-chat-scroll"}],staticClass:"my-3 p-3 bg-white rounded shadow-sm scroll"},[a("div",{staticClass:"media text pt-3"},[a("div",e._l(e.messages,(function(t){return a("div",{key:t.id,staticClass:"media-body pb-3 mb-0 lh-125"},[a("span",[e._v(e._s(t.value))]),a("span",{staticClass:"text-muted"},[e._v(e._s(t.sender)+", "+e._s(e.makeTimeReadable(t.timestamp)))]),e.user.uname==t.sender?a("a",{staticClass:"btn text-right text-muted",on:{click:function(a){return a.preventDefault(),e.delChat(t.timestamp)}}},[e._v("Delete")]):e._e()])})),0)])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("form",[a("div",{staticClass:"input-group add-on"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],staticClass:"form-control mr-1",attrs:{type:"text",id:"newMessage",placeholder:"Send a message..."},domProps:{value:e.newMessage},on:{input:[function(t){t.target.composing||(e.newMessage=t.target.value)},function(t){return e.checkInput()}]}}),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-primary",attrs:{disabled:e.disableSend},on:{click:function(t){return t.preventDefault(),e.sendMessage()}}},[e._v(" Send ")])])])])])])]),a("hr",{staticClass:"featurette-divider"}),a("footer",{staticClass:"container"},[e._m(0),a("p",[e._v(" © 2018 Humanistic Co-Design Initiative · "),a("a",[a("router-link",{attrs:{to:{name:"privacy"}}},[e._v("Privacy")])],1)])])])},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",{staticClass:"float-right"},[a("a",{attrs:{href:"#"}},[e._v("Back to top")])])}],r=(a("4de4"),a("96cf"),a("1da1")),c=a("c1df"),i=a.n(c),u=a("032d"),o={name:"chat",computed:{user:function(){return this.$store.state.user}},data:function(){return{uname:this.$route.params.uname,chatWith:null,chatID:null,messages:[],newMessage:null,disableSend:null}},methods:{sendMessage:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=u["c"].collection("chats").doc(e.chatID),t.next=3,a.get();case 3:return s=t.sent,e.messages=s.data().messages,e.messages.push({value:e.newMessage,sender:e.user.uname,timestamp:Date.now()}),t.next=8,a.update({messages:e.messages});case 8:e.newMessage=null;case 9:case"end":return t.stop()}}),t)})))()},checkInput:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:null==e.newMessage||""==e.newMessage?e.disableSend=!0:e.disableSend=!1;case 1:case"end":return t.stop()}}),t)})))()},delChat:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=u["c"].collection("chats").doc(t.chatID),a.next=3,s.get();case 3:return n=a.sent,t.messages=n.data().messages.filter((function(t){return t.timestamp!=e})),a.next=7,s.update({messages:t.messages});case 7:case"end":return a.stop()}}),a)})))()},makeTimeReadable:function(e){return i()(e).format("lll")}},created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,s,n,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u["c"].collection("users").where("uname","==",e.uname).get();case 2:if(a=t.sent,!a.empty){t.next=7;break}e.$router.push({name:"allchats"}),t.next=23;break;case 7:return e.chatWith=a.docs[0].data().displayName,s=[e.uname+e.user.uname,e.user.uname+e.uname,e.user.uname,e.uname,e.user.displayName,e.chatWith],t.next=11,u["c"].collection("chats").where("chatRoomID","array-contains",e.user.uname+e.uname).get();case 11:if(n=t.sent,r=u["c"].collection("chats"),!n.empty){t.next=19;break}return t.next=16,r.add({messages:[],chatRoomID:s});case 16:location.reload(),t.next=20;break;case 19:e.chatID=n.docs[0].id;case 20:c=u["c"].collection("chats").doc(e.chatID),c.onSnapshot((function(t){e.messages=t.data().messages})),e.disableSend=!0;case 23:case"end":return t.stop()}}),t)})))()}},l=o,m=(a("dc2d"),a("2877")),d=Object(m["a"])(l,s,n,!1,null,"551cc1e4",null);t["default"]=d.exports},dc2d:function(e,t,a){"use strict";var s=a("37b2"),n=a.n(s);n.a}}]);
//# sourceMappingURL=chunk-d601df9c.966bc4b7.js.map